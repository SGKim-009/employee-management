# Phase 4 테스트 가이드

이 문서는 Phase 4 고급 기능(평가 시스템, 휴가 관리, 급여 관리)의 테스트 방법을 안내합니다.

## 목차

1. [평가 시스템 테스트](#평가-시스템-테스트)
2. [휴가 관리 테스트](#휴가-관리-테스트)
3. [급여 관리 테스트](#급여-관리-테스트)

---

## 평가 시스템 테스트

### 테스트 파일
- `__tests__/integration/evaluationService.test.ts`

### 테스트 항목

#### 1. 평가 생성 및 조회 확인

**테스트 시나리오:**
1. 평가 항목 목록 조회
2. 새로운 평가 생성
3. 생성된 평가 조회
4. 직원별 평가 목록 조회

**수동 테스트 방법:**
1. `/evaluations` 페이지 접속
2. "새 평가 생성" 버튼 클릭
3. 직원 선택, 평가 기간 입력, 평가 항목별 점수 입력
4. 평가 저장 후 목록에서 확인
5. 직원 상세 페이지에서 평가 탭 확인

**확인 사항:**
- ✅ 평가가 정상적으로 생성되는가?
- ✅ 평가 점수가 올바르게 계산되는가? (가중 평균)
- ✅ 평가 목록에 새 평가가 표시되는가?
- ✅ 직원 상세 페이지에서 평가 이력이 표시되는가?

#### 2. 평가 이력 관리 확인

**테스트 시나리오:**
1. 평가 통계 조회
2. 평가 수정
3. 평가 상태 변경 (draft → submitted → approved)
4. 평가 삭제

**수동 테스트 방법:**
1. `/evaluations` 페이지에서 평가 목록 확인
2. 평가 상세 페이지(`/evaluations/[id]`) 접속
3. 평가 수정 버튼 클릭하여 점수 수정
4. 평가 상태 변경 (제출, 승인)
5. 평가 통계 확인 (직원 상세 페이지의 평가 탭)

**확인 사항:**
- ✅ 평가 통계가 올바르게 계산되는가?
- ✅ 평가 수정이 정상적으로 동작하는가?
- ✅ 평가 상태 변경이 정상적으로 동작하는가?
- ✅ 평가 삭제가 정상적으로 동작하는가?

---

## 휴가 관리 테스트

### 테스트 파일
- `__tests__/integration/leaveService.test.ts`

### 테스트 항목

#### 1. 휴가 신청/승인 플로우 확인

**테스트 시나리오:**
1. 휴가 신청 생성
2. 승인 대기 목록 확인
3. 휴가 승인
4. 휴가 거절
5. 휴가 취소

**수동 테스트 방법:**
1. `/leaves` 페이지 접속
2. "휴가 신청" 버튼 클릭
3. 직원 선택, 휴가 유형 선택, 시작일/종료일 입력, 사유 입력
4. 휴가 신청 제출
5. 관리자 계정으로 로그인하여 승인 대기 목록 확인
6. 휴가 승인 또는 거절
7. 승인된 휴가의 잔여일 업데이트 확인

**확인 사항:**
- ✅ 휴가 신청이 정상적으로 생성되는가?
- ✅ 휴가 일수가 올바르게 계산되는가?
- ✅ 승인 대기 목록에 신청이 표시되는가?
- ✅ 휴가 승인 시 상태가 변경되는가?
- ✅ 휴가 승인 시 잔여일이 차감되는가?
- ✅ 휴가 거절 시 거절 사유가 저장되는가?

#### 2. 휴가 일수 계산 정확성 확인

**테스트 시나리오:**
1. 연차 계산 (입사일 기준)
2. 휴가 잔여일 조회
3. 휴가 사용 후 잔여일 업데이트 확인

**수동 테스트 방법:**
1. 직원 상세 페이지에서 휴가 잔여일 카드 확인
2. 입사일이 다른 직원들의 연차 계산 확인
   - 입사 1년 미만: 비례 계산
   - 입사 1년 이상: 15일 + (근무년수 - 1)일 (최대 25일)
3. 휴가 신청 후 잔여일 변화 확인

**확인 사항:**
- ✅ 입사일 기준 연차 계산이 올바른가?
- ✅ 휴가 사용 후 잔여일이 정확히 차감되는가?
- ✅ 연도별 휴가 잔여일이 올바르게 관리되는가?

#### 3. 캘린더 뷰 동작 확인

**테스트 시나리오:**
1. 휴가 캘린더 페이지 접속
2. 월별 휴가 일정 확인
3. 휴가 일정 클릭하여 상세 정보 확인

**수동 테스트 방법:**
1. `/leaves/calendar` 페이지 접속
2. 캘린더에서 휴가 일정 확인
3. 월별 이동하여 휴가 일정 확인
4. 휴가 일정 클릭하여 상세 정보 확인

**확인 사항:**
- ✅ 캘린더에 휴가 일정이 올바르게 표시되는가?
- ✅ 월별 이동이 정상적으로 동작하는가?
- ✅ 휴가 일정 클릭 시 상세 정보가 표시되는가?
- ✅ 휴가 유형별 색상 구분이 되는가?

---

## 급여 관리 테스트

### 테스트 파일
- `__tests__/integration/payrollService.test.ts`

### 테스트 항목

#### 1. 급여 명세서 생성 및 다운로드 확인

**테스트 시나리오:**
1. 급여 명세서 생성
2. 급여 명세서 조회
3. PDF 다운로드

**수동 테스트 방법:**
1. `/payroll` 페이지 접속
2. "새 급여 명세서" 버튼 클릭
3. 직원 선택, 급여 정보 입력 (기본급, 시간외수당, 상여금, 수당)
4. 급여 명세서 생성
5. 생성된 명세서 목록에서 확인
6. PDF 다운로드 버튼 클릭하여 PDF 생성 확인

**확인 사항:**
- ✅ 급여 명세서가 정상적으로 생성되는가?
- ✅ 총 지급액이 올바르게 계산되는가?
- ✅ 공제액이 올바르게 계산되는가?
- ✅ 실지급액이 올바르게 계산되는가?
- ✅ PDF가 정상적으로 생성되는가?
- ✅ PDF 내용이 올바른가?

#### 2. 세금 계산 정확성 확인

**테스트 시나리오:**
1. 다양한 소득 구간에서 세금 계산 확인
2. 4대 보험 계산 확인
3. 소득세 누진세율 확인

**수동 테스트 방법:**
1. 다양한 급여 수준의 명세서 생성
   - 1천만원 이하
   - 1천만원 ~ 4천6백만원
   - 4천6백만원 ~ 8천8백만원
   - 8천8백만원 ~ 1억5천만원
   - 1억5천만원 이상
2. 각 구간의 세금 계산 확인
3. 4대 보험 계산 확인
   - 국민연금: 4.5%
   - 건강보험: 3.545%
   - 장기요양보험: 건강보험료의 12.27%
   - 고용보험: 0.9%

**확인 사항:**
- ✅ 소득세 누진세율이 올바르게 적용되는가?
- ✅ 지방소득세가 소득세의 10%로 계산되는가?
- ✅ 4대 보험 계산이 올바른가?
- ✅ 총 공제액이 모든 항목의 합인가?

#### 3. 급여 이체 내역 관리 확인

**테스트 시나리오:**
1. 급여 이체 내역 생성
2. 이체 내역 조회
3. 이체 상태 업데이트

**수동 테스트 방법:**
1. 급여 명세서 생성 후 이체 내역 생성
2. 이체일, 이체금액, 계좌 정보 입력
3. 이체 내역 목록에서 확인
4. 이체 상태 변경 (pending → completed / failed)
5. 이체 실패 시 실패 사유 입력

**확인 사항:**
- ✅ 급여 이체 내역이 정상적으로 생성되는가?
- ✅ 이체 내역 목록이 올바르게 표시되는가?
- ✅ 이체 상태 변경이 정상적으로 동작하는가?
- ✅ 이체 실패 사유가 저장되는가?

---

## 통합 테스트 실행 방법

### 환경 변수 설정

테스트를 실행하기 전에 `.env.local` 파일에 다음 환경 변수가 설정되어 있어야 합니다:

```env
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
```

### 테스트 실행

```bash
# 모든 통합 테스트 실행
npm test -- __tests__/integration/

# 평가 시스템 테스트만 실행
npm test -- __tests__/integration/evaluationService.test.ts

# 휴가 관리 테스트만 실행
npm test -- __tests__/integration/leaveService.test.ts

# 급여 관리 테스트만 실행
npm test -- __tests__/integration/payrollService.test.ts
```

### 주의사항

- 통합 테스트는 실제 Supabase 데이터베이스에 연결되므로, 테스트 데이터가 생성될 수 있습니다.
- 테스트 후 정리 작업이 필요할 수 있습니다.
- 프로덕션 환경에서는 테스트를 실행하지 마세요.

---

## 테스트 체크리스트

### 평가 시스템
- [ ] 평가 생성 및 조회 확인
- [ ] 평가 이력 관리 확인
- [ ] 평가 통계 조회 확인
- [ ] 평가 항목 관리 확인

### 휴가 관리
- [ ] 휴가 신청/승인 플로우 확인
- [ ] 휴가 일수 계산 정확성 확인
- [ ] 캘린더 뷰 동작 확인
- [ ] 휴가 잔여일 관리 확인

### 급여 관리
- [ ] 급여 명세서 생성 및 다운로드 확인
- [ ] 세금 계산 정확성 확인
- [ ] 급여 이체 내역 관리 확인
- [ ] 급여 요약 조회 확인

---

**마지막 업데이트**: 2024년

