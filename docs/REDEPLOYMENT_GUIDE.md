# 재배포 가이드

이 문서는 이미 배포된 인사관리 시스템을 재배포하는 방법을 안내합니다.

---

## 📋 목차

1. [자동 재배포 (권장)](#1-자동-재배포-권장)
2. [수동 재배포](#2-수동-재배포)
3. [환경 변수 변경 후 재배포](#3-환경-변수-변경-후-재배포)
4. [특정 버전으로 롤백](#4-특정-버전으로-롤백)
5. [문제 해결](#5-문제-해결)

---

## 1. 자동 재배포 (권장)

Vercel은 Git 저장소와 연결되어 있으면 자동으로 재배포됩니다.

### 1.1 코드 변경 후 자동 재배포

1. **로컬에서 코드 수정**
   ```bash
   # 파일 수정 후
   git add .
   git commit -m "기능 추가: 엑셀 연동"
   git push origin main
   ```

2. **자동 배포 확인**
   - Vercel 대시보드에서 자동으로 배포가 시작됩니다
   - 배포 상태는 Vercel 대시보드 > 프로젝트 > **Deployments**에서 확인 가능
   - 배포 완료까지 약 2-3분 소요

3. **배포 완료 확인**
   - 배포가 완료되면 이메일 알림을 받거나
   - Vercel 대시보드에서 "Ready" 상태 확인

### 1.2 자동 배포 설정 확인

Vercel 대시보드 > 프로젝트 > **Settings** > **Git**에서 확인:

- ✅ **Production Branch**: `main` 또는 `master`로 설정되어 있는지 확인
- ✅ **Auto-deploy**: 활성화되어 있는지 확인

---

## 2. 수동 재배포

코드를 변경하지 않고 현재 버전을 다시 배포하고 싶을 때 사용합니다.

### 2.1 Vercel에서 수동 재배포

#### 방법 1: 대시보드에서 재배포

1. Vercel 대시보드 접속
2. 프로젝트 선택
3. **Deployments** 탭 클릭
4. 재배포하고 싶은 배포 항목 찾기
5. **⋯** (점 3개) 메뉴 클릭
6. **Redeploy** 선택
7. 확인 대화상자에서 **Redeploy** 클릭

#### 방법 2: 특정 커밋으로 재배포

1. **Deployments** 탭에서 원하는 배포 항목 찾기
2. **⋯** 메뉴 클릭
3. **Redeploy** 선택
4. 필요시 다른 브랜치나 커밋 선택 가능

### 2.2 Vercel CLI로 재배포

```bash
# Vercel CLI 설치 (처음 한 번만)
npm install -g vercel

# 로그인
vercel login

# 프로젝트 디렉토리에서 재배포
vercel --prod
```

---

## 3. 환경 변수 변경 후 재배포

환경 변수를 변경한 후에는 재배포가 필요합니다.

### 3.1 Vercel에서 환경 변수 변경

1. Vercel 대시보드 > 프로젝트 > **Settings** > **Environment Variables**
2. 변경할 환경 변수 찾기
3. **Edit** 클릭하여 값 수정
4. **Save** 클릭

### 3.2 환경 변수 변경 후 재배포

환경 변수를 변경하면 자동으로 재배포가 트리거됩니다. 수동으로 재배포하려면:

1. **Deployments** 탭으로 이동
2. 최신 배포 항목의 **⋯** 메뉴 클릭
3. **Redeploy** 선택

또는 Vercel CLI 사용:
```bash
vercel --prod
```

### 3.3 환경 변수 확인

재배포 후 환경 변수가 제대로 적용되었는지 확인:

1. 배포된 사이트 접속
2. 브라우저 개발자 도구 (F12) > **Console** 탭
3. 다음 코드 실행:
   ```javascript
   console.log('Supabase URL:', process.env.NEXT_PUBLIC_SUPABASE_URL);
   ```
   (참고: 브라우저에서는 `process.env`가 작동하지 않을 수 있습니다)

또는 애플리케이션 코드에서 확인:
- 로그인 페이지가 정상적으로 작동하는지 확인
- Supabase 연결 오류가 없는지 확인

---

## 4. 특정 버전으로 롤백

이전 버전으로 되돌리고 싶을 때 사용합니다.

### 4.1 Vercel에서 롤백

1. Vercel 대시보드 > 프로젝트 > **Deployments** 탭
2. 롤백하고 싶은 이전 배포 항목 찾기
3. **⋯** 메뉴 클릭
4. **Promote to Production** 선택
5. 확인 대화상자에서 **Promote** 클릭

### 4.2 Git으로 롤백

```bash
# 이전 커밋으로 되돌리기
git revert HEAD
git push origin main

# 특정 커밋으로 되돌리기
git revert <commit-hash>
git push origin main
```

---

## 5. 문제 해결

### 5.1 재배포가 자동으로 되지 않는 경우

**원인**: Git 저장소 연결 문제, 자동 배포 비활성화

**해결**:
1. Vercel 대시보드 > 프로젝트 > **Settings** > **Git** 확인
2. Git 저장소가 연결되어 있는지 확인
3. **Production Branch**가 올바르게 설정되어 있는지 확인
4. **Auto-deploy**가 활성화되어 있는지 확인

### 5.2 재배포 후 오류 발생

**원인**: 환경 변수 누락, 빌드 오류, 의존성 문제

**해결**:
1. **빌드 로그 확인**
   - Vercel 대시보드 > **Deployments** > 실패한 배포 클릭
   - 빌드 로그에서 오류 확인

2. **로컬에서 빌드 테스트**
   ```bash
   npm run build
   ```
   - 로컬에서 빌드가 성공하는지 확인
   - 오류가 있다면 수정 후 다시 푸시

3. **환경 변수 확인**
   - Vercel 대시보드 > **Settings** > **Environment Variables**
   - 모든 필수 환경 변수가 설정되어 있는지 확인

### 5.3 재배포 후 기능이 작동하지 않는 경우

**원인**: 환경 변수 미적용, 캐시 문제, Supabase 설정 문제

**해결**:
1. **브라우저 캐시 삭제**
   - Ctrl + Shift + Delete (Windows/Linux)
   - Cmd + Shift + Delete (Mac)
   - 또는 시크릿 모드에서 테스트

2. **환경 변수 재확인**
   - Vercel 대시보드에서 환경 변수 확인
   - 재배포 후에도 환경 변수가 적용되었는지 확인

3. **Supabase 설정 확인**
   - Supabase 대시보드 > **Authentication** > **URL Configuration**
   - 배포된 URL이 올바르게 설정되어 있는지 확인

### 5.4 재배포가 너무 오래 걸리는 경우

**원인**: 빌드 시간 초과, 의존성 설치 문제

**해결**:
1. **빌드 로그 확인**
   - 어느 단계에서 멈추는지 확인
   - 타임아웃 오류가 있는지 확인

2. **의존성 최적화**
   - 불필요한 패키지 제거
   - `package.json`의 의존성 확인

3. **Vercel 빌드 설정 확인**
   - **Settings** > **General** > **Build & Development Settings**
   - 빌드 타임아웃 설정 확인 (기본 45분)

---

## 6. 재배포 체크리스트

재배포 전 확인사항:

- [ ] 로컬에서 `npm run build`가 성공함
- [ ] 변경사항이 Git에 커밋 및 푸시됨
- [ ] 환경 변수가 올바르게 설정됨
- [ ] Supabase 프로젝트가 활성화되어 있음
- [ ] 중요한 데이터는 백업됨 (필요시)

재배포 후 확인사항:

- [ ] 배포가 성공적으로 완료됨
- [ ] 배포된 사이트가 정상적으로 로드됨
- [ ] 로그인/회원가입이 작동함
- [ ] 주요 기능이 정상 작동함
- [ ] 브라우저 콘솔에 에러가 없음
- [ ] 환경 변수가 제대로 적용됨

---

## 7. 빠른 재배포 명령어

### Git을 통한 자동 재배포

```bash
# 변경사항 커밋 및 푸시
git add .
git commit -m "변경사항 설명"
git push origin main
```

### Vercel CLI를 통한 수동 재배포

```bash
# 프로덕션 배포
vercel --prod

# 프리뷰 배포
vercel
```

---

## 8. 재배포 모범 사례

1. **작은 변경사항으로 자주 배포**
   - 큰 변경사항을 한 번에 배포하지 말고, 작은 단위로 나누어 배포
   - 문제 발생 시 롤백이 쉬움

2. **프리뷰 배포 활용**
   - `main` 브랜치가 아닌 다른 브랜치에 푸시하면 프리뷰 URL 생성
   - 프로덕션 배포 전에 테스트 가능

3. **배포 전 로컬 테스트**
   - 재배포 전에 로컬에서 `npm run build` 실행
   - 빌드 오류를 미리 확인

4. **환경 변수 관리**
   - 환경 변수 변경 시 문서화
   - 팀원들과 변경사항 공유

5. **모니터링**
   - 배포 후 즉시 주요 기능 테스트
   - 에러 모니터링 도구 사용 (선택사항)

---

## 참고 자료

- [Vercel 배포 문서](https://vercel.com/docs)
- [Vercel CLI 문서](https://vercel.com/docs/cli)
- [배포 가이드](./DEPLOYMENT_GUIDE.md)
- [문제 해결 가이드](./DEPLOYMENT_GUIDE.md#5-문제-해결)

